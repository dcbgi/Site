<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TV Show Tracker â€“ dcbgi</title>
  <style>
    /* â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg:        #0f1117;
      --surface:   #1a1d27;
      --surface2:  #22263a;
      --border:    #2a2d3a;
      --accent:    #7c6af7;
      --accent-lt: #a899ff;
      --text:      #e2e4f0;
      --text-muted:#8b8fa8;
      --danger:    #e05c6e;
      --success:   #4caf82;
      --star:      #f5c842;
      --radius:    12px;
      --transition:0.2s ease;
    }
    html { scroll-behavior: smooth; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    a { color: var(--accent-lt); text-decoration: none; }
    a:hover { color: #fff; }

    /* â”€â”€ Navbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .navbar {
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      background: rgba(15,17,23,.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
    }
    .nav-logo {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--accent-lt);
      letter-spacing: .05em;
    }
    .nav-back {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-muted);
      transition: color var(--transition);
    }
    .nav-back:hover { color: var(--text); }

    /* â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 3rem 1.5rem 4rem;
      gap: 2rem;
    }
    .page-header { text-align: center; }
    .page-header h1 {
      font-size: clamp(1.6rem, 4vw, 2.4rem);
      font-weight: 800;
      margin-bottom: 0.4rem;
    }
    .page-header p { color: var(--text-muted); font-size: 1rem; }
    .accent { color: var(--accent-lt); }

    /* â”€â”€ Panels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem 2rem;
      width: 100%;
      max-width: 700px;
    }
    .panel-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--accent-lt);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .badge {
      background: rgba(124,106,247,.2);
      border: 1px solid rgba(124,106,247,.35);
      border-radius: 20px;
      font-size: 0.72rem;
      padding: 0.1rem 0.55rem;
      color: var(--accent-lt);
      font-weight: 700;
    }

    /* â”€â”€ Add-show form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .add-show-form {
      display: flex;
      gap: 0.75rem;
    }
    .add-show-form input[type="text"] {
      flex: 1;
      padding: 0.6rem 0.9rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 0.95rem;
      outline: none;
      transition: border-color var(--transition);
    }
    .add-show-form input[type="text"]:focus {
      border-color: var(--accent);
    }
    .add-show-form input[type="text"]::placeholder { color: var(--text-muted); }

    /* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn {
      padding: 0.55rem 1.1rem;
      border-radius: 8px;
      font-size: 0.88rem;
      font-weight: 700;
      cursor: pointer;
      transition: background var(--transition), color var(--transition);
      border: none;
    }
    .btn-primary {
      background: var(--accent);
      color: #fff;
    }
    .btn-primary:hover { background: var(--accent-lt); color: #fff; }
    .btn-ghost {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
    }
    .btn-ghost:hover { border-color: var(--accent-lt); color: var(--accent-lt); }
    .btn-danger {
      background: transparent;
      border: 1px solid transparent;
      color: var(--text-muted);
      font-size: 0.8rem;
      padding: 0.3rem 0.6rem;
    }
    .btn-danger:hover { color: var(--danger); }
    .btn-success {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      font-size: 0.8rem;
      padding: 0.3rem 0.7rem;
    }
    .btn-success:hover { border-color: var(--success); color: var(--success); }
    .btn-sm {
      font-size: 0.8rem;
      padding: 0.3rem 0.7rem;
    }

    /* â”€â”€ Show cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .shows-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .show-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      width: 100%;
      max-width: 700px;
    }
    .show-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.25rem;
      cursor: pointer;
      user-select: none;
      gap: 0.75rem;
      transition: background var(--transition);
    }
    .show-header:hover { background: rgba(255,255,255,.03); }
    .show-header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      min-width: 0;
    }
    .show-title-text {
      font-weight: 700;
      font-size: 1rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .ep-count {
      font-size: 0.8rem;
      color: var(--text-muted);
      white-space: nowrap;
    }
    .avg-rating {
      font-size: 0.8rem;
      color: var(--star);
      white-space: nowrap;
    }
    .show-header-right {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-shrink: 0;
    }
    .chevron {
      color: var(--text-muted);
      font-size: 0.85rem;
      transition: transform var(--transition);
    }
    .show-card.open .chevron { transform: rotate(180deg); }

    /* â”€â”€ Show body â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .show-body {
      display: none;
      border-top: 1px solid var(--border);
      padding: 1.25rem;
    }
    .show-card.open .show-body { display: block; }

    /* â”€â”€ Episode list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .episodes-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .episode-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.55rem 0.75rem;
      background: var(--surface2);
      border-radius: 8px;
      font-size: 0.9rem;
    }
    .ep-num {
      color: var(--accent-lt);
      font-weight: 700;
      font-size: 0.8rem;
      min-width: 2.2rem;
    }
    .ep-title {
      flex: 1;
      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: var(--text);
    }
    .ep-title.untitled { color: var(--text-muted); font-style: italic; }
    .ep-date {
      font-size: 0.75rem;
      color: var(--text-muted);
      white-space: nowrap;
    }

    /* â”€â”€ Stars â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stars {
      display: flex;
      gap: 1px;
    }
    .star {
      font-size: 1rem;
      color: var(--border);
      cursor: pointer;
      transition: color var(--transition), transform var(--transition);
      background: none;
      border: none;
      padding: 0 1px;
      line-height: 1;
    }
    .star.filled { color: var(--star); }
    .star:hover { transform: scale(1.2); }
    /* read-only star display */
    .stars-display { display: flex; gap: 1px; }
    .star-display {
      font-size: 0.9rem;
      color: var(--border);
      line-height: 1;
    }
    .star-display.filled { color: var(--star); }

    /* â”€â”€ Log-episode form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .log-form {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      margin-top: 0.75rem;
      display: none;
    }
    .log-form.open { display: block; }
    .log-form-title {
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--accent-lt);
      margin-bottom: 0.75rem;
    }
    .log-form-fields {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      align-items: flex-end;
    }
    .form-field {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    .form-label {
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    .form-input {
      padding: 0.45rem 0.7rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      font-size: 0.88rem;
      outline: none;
      transition: border-color var(--transition);
    }
    .form-input:focus { border-color: var(--accent); }
    .form-input::placeholder { color: var(--text-muted); }
    .form-input.ep-num-input { width: 5rem; }
    .form-input.ep-title-input { width: 14rem; }
    .rating-field { flex-direction: column; gap: 0.25rem; }
    .log-form-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    /* â”€â”€ Empty state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .empty-state {
      text-align: center;
      padding: 2rem;
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    .empty-icon { font-size: 2rem; margin-bottom: 0.5rem; }

    /* â”€â”€ Completed shows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .completed-badge {
      font-size: 0.72rem;
      background: rgba(76,175,130,.15);
      border: 1px solid rgba(76,175,130,.3);
      border-radius: 20px;
      padding: 0.1rem 0.5rem;
      color: var(--success);
      font-weight: 700;
    }

    /* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    footer {
      text-align: center;
      padding: 1.5rem;
      color: var(--text-muted);
      font-size: 0.85rem;
      border-top: 1px solid var(--border);
    }

    @media (max-width: 500px) {
      .navbar { padding: 0.85rem 1.25rem; }
      .add-show-form { flex-direction: column; }
      .form-input.ep-title-input { width: 100%; }
      .log-form-fields { flex-direction: column; }
    }
  </style>
</head>
<body>

  <!-- Navigation -->
  <nav class="navbar">
    <span class="nav-logo">Berry Better Solutions</span>
    <a href="index.html" class="nav-back">â† Back to Profile</a>
  </nav>

  <main>

    <div class="page-header">
      <h1>ğŸ“º <span class="accent">TV Show Tracker</span></h1>
      <p>Log every show and episode you watch â€” with ratings</p>
    </div>

    <!-- Add Show -->
    <div class="panel" id="add-panel">
      <div class="panel-title">Add a New Show</div>
      <form class="add-show-form" id="add-show-form" autocomplete="off">
        <input
          type="text"
          id="show-input"
          placeholder="Enter show titleâ€¦"
          maxlength="120"
          aria-label="Show title"
        />
        <button type="submit" class="btn btn-primary">+ Add Show</button>
      </form>
    </div>

    <!-- Currently Watching -->
    <div class="panel" id="watching-panel">
      <div class="panel-title">
        Currently Watching
        <span class="badge" id="watching-count">0</span>
      </div>
      <div class="shows-list" id="watching-list">
        <div class="empty-state">
          <div class="empty-icon">ğŸ¬</div>
          <p>No shows yet â€” add one above!</p>
        </div>
      </div>
    </div>

    <!-- Completed -->
    <div class="panel" id="completed-panel">
      <div class="panel-title">
        Completed
        <span class="badge" id="completed-count">0</span>
      </div>
      <div class="shows-list" id="completed-list">
        <div class="empty-state">
          <div class="empty-icon">âœ…</div>
          <p>No completed shows yet.</p>
        </div>
      </div>
    </div>

  </main>

  <footer>
    <p>&copy; <span id="year"></span> dcbgi. TV Show Tracker â€” data saved in your browser.</p>
  </footer>

  <script>
  (function () {
    "use strict";

    // â”€â”€ Storage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    var STORAGE_KEY = "tvtracker_shows";

    function loadShows() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
      } catch (e) {
        return [];
      }
    }

    function saveShows(shows) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(shows));
    }

    // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    var shows = loadShows();
    // Track which show cards are open {id: bool}
    var openCards = {};
    // Track which log forms are open {id: bool}
    var openForms = {};
    // Track pending star rating per show's log form
    var pendingRating = {};

    // â”€â”€ ID generator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function genId() {
      return Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
    }

    // â”€â”€ Next episode number for a show â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function nextEpNum(show) {
      if (!show.episodes.length) return 1;
      return Math.max.apply(null, show.episodes.map(function (e) { return e.number; })) + 1;
    }

    // â”€â”€ Average rating â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function avgRating(show) {
      var rated = show.episodes.filter(function (e) { return e.rating > 0; });
      if (!rated.length) return 0;
      var sum = rated.reduce(function (acc, e) { return acc + e.rating; }, 0);
      return (sum / rated.length).toFixed(1);
    }

    // â”€â”€ Escape HTML â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function esc(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    // â”€â”€ Render stars (display only) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function starsHtml(rating) {
      var html = '<span class="stars-display" aria-label="' + rating + ' out of 5 stars">';
      for (var i = 1; i <= 5; i++) {
        html += '<span class="star-display' + (i <= rating ? " filled" : "") + '">â˜…</span>';
      }
      html += "</span>";
      return html;
    }

    // â”€â”€ Format date â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function fmtDate(ts) {
      var d = new Date(ts);
      return d.toLocaleDateString(undefined, { month: "short", day: "numeric", year: "numeric" });
    }

    // â”€â”€ Build show card HTML â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showCardHtml(show) {
      var isOpen = !!openCards[show.id];
      var epCount = show.episodes.length;
      var avg = avgRating(show);
      var isCompleted = show.status === "completed";

      var episodesHtml = "";
      if (epCount === 0) {
        episodesHtml = '<p class="empty-state" style="padding:0.75rem 0;text-align:left;">No episodes logged yet.</p>';
      } else {
        episodesHtml = '<div class="episodes-list">';
        show.episodes.forEach(function (ep) {
          episodesHtml +=
            '<div class="episode-row" data-ep-id="' + esc(ep.id) + '">' +
              '<span class="ep-num">E' + esc(ep.number) + '</span>' +
              '<span class="ep-title' + (ep.title ? "" : " untitled") + '">' +
                (ep.title ? esc(ep.title) : "Untitled episode") +
              "</span>" +
              (ep.rating > 0 ? starsHtml(ep.rating) : '<span style="color:var(--text-muted);font-size:0.8rem;">Unrated</span>') +
              '<span class="ep-date">' + fmtDate(ep.loggedAt) + "</span>" +
              '<button class="btn btn-danger delete-ep-btn" data-show-id="' + esc(show.id) + '" data-ep-id="' + esc(ep.id) + '" aria-label="Delete episode ' + esc(ep.number) + '">âœ•</button>' +
            "</div>";
        });
        episodesHtml += "</div>";
      }

      // Log form
      var formOpen = !!openForms[show.id];
      var pr = pendingRating[show.id] || 0;
      var starsInput = "";
      for (var s = 1; s <= 5; s++) {
        starsInput += '<button type="button" class="star rating-star' + (s <= pr ? " filled" : "") + '" data-val="' + s + '" aria-label="' + s + ' star' + (s > 1 ? "s" : "") + '">â˜…</button>';
      }

      var logFormHtml =
        '<div class="log-form' + (formOpen ? " open" : "") + '" id="log-form-' + esc(show.id) + '">' +
          '<div class="log-form-title">Log an Episode</div>' +
          '<div class="log-form-fields">' +
            '<div class="form-field">' +
              '<label class="form-label" for="ep-num-' + esc(show.id) + '">Episode #</label>' +
              '<input class="form-input ep-num-input" type="number" id="ep-num-' + esc(show.id) + '" min="1" max="9999" value="' + nextEpNum(show) + '" />' +
            "</div>" +
            '<div class="form-field">' +
              '<label class="form-label" for="ep-title-' + esc(show.id) + '">Title (optional)</label>' +
              '<input class="form-input ep-title-input" type="text" id="ep-title-' + esc(show.id) + '" placeholder="Episode titleâ€¦" maxlength="120" />' +
            "</div>" +
            '<div class="form-field rating-field">' +
              '<span class="form-label">Rating (optional)</span>' +
              '<div class="stars" id="stars-' + esc(show.id) + '">' + starsInput + "</div>" +
            "</div>" +
          "</div>" +
          '<div class="log-form-actions">' +
            '<button class="btn btn-primary btn-sm log-ep-submit" data-show-id="' + esc(show.id) + '">Log Episode</button>' +
            '<button class="btn btn-ghost btn-sm log-ep-cancel" data-show-id="' + esc(show.id) + '">Cancel</button>' +
          "</div>" +
        "</div>";

      var actionBtns = "";
      if (!isCompleted) {
        actionBtns +=
          '<button class="btn btn-success toggle-log-btn btn-sm" data-show-id="' + esc(show.id) + '">' +
            (formOpen ? "Cancel" : "+ Log Episode") +
          "</button> " +
          '<button class="btn btn-success btn-sm mark-complete-btn" data-show-id="' + esc(show.id) + '">Mark Complete</button> ';
      } else {
        actionBtns +=
          '<button class="btn btn-ghost btn-sm mark-watching-btn" data-show-id="' + esc(show.id) + '">Move to Watching</button> ';
      }
      actionBtns += '<button class="btn btn-danger btn-sm delete-show-btn" data-show-id="' + esc(show.id) + '">Delete</button>';

      return (
        '<div class="show-card' + (isOpen ? " open" : "") + '" id="show-' + esc(show.id) + '">' +
          '<div class="show-header toggle-card-btn" data-show-id="' + esc(show.id) + '">' +
            '<div class="show-header-left">' +
              '<span class="show-title-text">' + esc(show.title) + "</span>" +
              '<span class="ep-count">' + epCount + " ep" + (epCount !== 1 ? "s" : "") + "</span>" +
              (avg > 0 ? '<span class="avg-rating">â˜… ' + avg + "</span>" : "") +
              (isCompleted ? '<span class="completed-badge">Completed</span>' : "") +
            "</div>" +
            '<div class="show-header-right">' +
              '<span class="chevron">â–¼</span>' +
            "</div>" +
          "</div>" +
          '<div class="show-body">' +
            episodesHtml +
            (!isCompleted ? logFormHtml : "") +
            '<div style="margin-top:' + (isCompleted ? "0" : "0.75rem") + ';display:flex;flex-wrap:wrap;gap:0.5rem;">' +
              actionBtns +
            "</div>" +
          "</div>" +
        "</div>"
      );
    }

    // â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function render() {
      var watching = shows.filter(function (s) { return s.status === "watching"; });
      var completed = shows.filter(function (s) { return s.status === "completed"; });

      document.getElementById("watching-count").textContent = watching.length;
      document.getElementById("completed-count").textContent = completed.length;

      var wList = document.getElementById("watching-list");
      var cList = document.getElementById("completed-list");

      if (watching.length === 0) {
        wList.innerHTML =
          '<div class="empty-state"><div class="empty-icon">ğŸ¬</div><p>No shows yet â€” add one above!</p></div>';
      } else {
        wList.innerHTML = watching.map(showCardHtml).join("");
      }

      if (completed.length === 0) {
        cList.innerHTML =
          '<div class="empty-state"><div class="empty-icon">âœ…</div><p>No completed shows yet.</p></div>';
      } else {
        cList.innerHTML = completed.map(showCardHtml).join("");
      }
    }

    // â”€â”€ Find show by id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function findShow(id) {
      return shows.find(function (s) { return s.id === id; });
    }

    // â”€â”€ Event delegation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.addEventListener("click", function (e) {
      var target = e.target;

      // Toggle card open/close (clicking header, but not buttons inside)
      var toggleBtn = target.closest(".toggle-card-btn");
      if (toggleBtn && !target.closest("button")) {
        var sid = toggleBtn.dataset.showId;
        openCards[sid] = !openCards[sid];
        render();
        return;
      }

      // Toggle log form
      var logToggle = target.closest(".toggle-log-btn");
      if (logToggle) {
        var sid = logToggle.dataset.showId;
        openCards[sid] = true;
        openForms[sid] = !openForms[sid];
        render();
        return;
      }

      // Cancel log form
      var logCancel = target.closest(".log-ep-cancel");
      if (logCancel) {
        var sid = logCancel.dataset.showId;
        openForms[sid] = false;
        render();
        return;
      }

      // Star rating selection â€” update in-place to preserve other form field values
      var ratingStar = target.closest(".rating-star");
      if (ratingStar) {
        var val = parseInt(ratingStar.dataset.val, 10);
        var starsContainer = ratingStar.closest(".stars");
        if (starsContainer) {
          var sid = starsContainer.id.replace("stars-", "");
          pendingRating[sid] = (pendingRating[sid] === val) ? 0 : val;
          var pr = pendingRating[sid];
          starsContainer.querySelectorAll(".rating-star").forEach(function (s) {
            var sv = parseInt(s.dataset.val, 10);
            s.classList.toggle("filled", sv <= pr);
          });
        }
        return;
      }

      // Submit log episode
      var logSubmit = target.closest(".log-ep-submit");
      if (logSubmit) {
        var sid = logSubmit.dataset.showId;
        var show = findShow(sid);
        if (!show) return;

        var numEl = document.getElementById("ep-num-" + sid);
        var titleEl = document.getElementById("ep-title-" + sid);
        var epNum = parseInt(numEl.value, 10);
        var epTitle = titleEl.value.trim();
        var rating = pendingRating[sid] || 0;

        if (!epNum || epNum < 1) { numEl.focus(); return; }

        show.episodes.push({
          id: genId(),
          number: epNum,
          title: epTitle,
          rating: rating,
          loggedAt: Date.now(),
        });

        // Sort episodes by number
        show.episodes.sort(function (a, b) { return a.number - b.number; });

        openForms[sid] = false;
        delete pendingRating[sid];
        saveShows(shows);
        render();
        return;
      }

      // Delete episode
      var delEp = target.closest(".delete-ep-btn");
      if (delEp) {
        var sid = delEp.dataset.showId;
        var epId = delEp.dataset.epId;
        var show = findShow(sid);
        if (!show) return;
        if (!confirm("Delete this episode entry?")) return;
        show.episodes = show.episodes.filter(function (e) { return e.id !== epId; });
        saveShows(shows);
        render();
        return;
      }

      // Mark complete
      var markComplete = target.closest(".mark-complete-btn");
      if (markComplete) {
        var sid = markComplete.dataset.showId;
        var show = findShow(sid);
        if (show) {
          show.status = "completed";
          openForms[sid] = false;
          saveShows(shows);
          render();
        }
        return;
      }

      // Move back to watching
      var markWatching = target.closest(".mark-watching-btn");
      if (markWatching) {
        var sid = markWatching.dataset.showId;
        var show = findShow(sid);
        if (show) {
          show.status = "watching";
          saveShows(shows);
          render();
        }
        return;
      }

      // Delete show
      var delShow = target.closest(".delete-show-btn");
      if (delShow) {
        var sid = delShow.dataset.showId;
        var show = findShow(sid);
        if (!show) return;
        if (!confirm('Delete "' + show.title + '" and all its episodes?')) return;
        shows = shows.filter(function (s) { return s.id !== sid; });
        delete openCards[sid];
        delete openForms[sid];
        delete pendingRating[sid];
        saveShows(shows);
        render();
        return;
      }
    });

    // â”€â”€ Add show form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById("add-show-form").addEventListener("submit", function (e) {
      e.preventDefault();
      var input = document.getElementById("show-input");
      var title = input.value.trim();
      if (!title) { input.focus(); return; }

      var id = genId();
      shows.push({
        id: id,
        title: title,
        status: "watching",
        addedAt: Date.now(),
        episodes: [],
      });

      openCards[id] = true;
      input.value = "";
      saveShows(shows);
      render();
      // Scroll to the new card after render
      setTimeout(function () {
        var card = document.getElementById("show-" + id);
        if (card) card.scrollIntoView({ behavior: "smooth", block: "nearest" });
      }, 50);
    });

    // â”€â”€ Footer year â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    var yearEl = document.getElementById("year");
    if (yearEl) yearEl.textContent = new Date().getFullYear();

    // â”€â”€ Initial render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    render();
  }());
  </script>

</body>
</html>
