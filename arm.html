<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3D Robot Arm – dcbgi</title>
  <style>
    /* ── Reset & Base ──────────────────────────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg:        #0f1117;
      --surface:   #1a1d27;
      --border:    #2a2d3a;
      --accent:    #7c6af7;
      --accent-lt: #a899ff;
      --text:      #e2e4f0;
      --text-muted:#8b8fa8;
      --radius:    12px;
      --transition:0.25s ease;
    }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    a { color: var(--accent-lt); text-decoration: none; }
    a:hover { color: #fff; }

    /* ── Navbar ────────────────────────────────────────────────────────────── */
    .navbar {
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      background: rgba(15,17,23,.85);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
    }
    .nav-logo {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--accent-lt);
      letter-spacing: .05em;
    }
    .nav-back {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-muted);
      transition: color var(--transition);
    }
    .nav-back:hover { color: var(--text); }

    /* ── Main ──────────────────────────────────────────────────────────────── */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 3rem 1.5rem 4rem;
      gap: 2rem;
    }
    .page-header { text-align: center; }
    .page-header h1 {
      font-size: clamp(1.6rem, 4vw, 2.4rem);
      font-weight: 800;
      margin-bottom: 0.4rem;
    }
    .page-header p { color: var(--text-muted); font-size: 1rem; }
    .accent { color: var(--accent-lt); }

    /* ── Canvas wrapper ────────────────────────────────────────────────────── */
    .canvas-wrapper {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1rem;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      max-width: 540px;
    }
    #arm-canvas {
      display: block;
      border-radius: 6px;
      cursor: default;
      outline: none;
      width: 100% !important;
      height: auto !important;
      aspect-ratio: 1;
    }
    #arm-canvas:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    /* ── Controls panel ────────────────────────────────────────────────────── */
    .controls-panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem 2rem;
      width: 100%;
      max-width: 540px;
    }
    .controls-panel h2 {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--accent-lt);
    }
    .controls-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.6rem 2rem;
    }
    .control-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }
    .control-label { color: var(--text-muted); font-size: 0.88rem; }
    .hand-hint {
      display: flex;
      gap: 0.75rem;
      font-size: 0.8rem;
    }
    .hand-hint-item {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      color: var(--text-muted);
    }
    .hand-legend-detail { grid-column: 1 / -1; }
    .keys {
      display: flex;
      gap: 0.3rem;
    }
    kbd {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0.15rem 0.45rem;
      font-size: 0.8rem;
      font-family: monospace;
      color: var(--accent-lt);
      line-height: 1.5;
    }

    /* ── Button controls ───────────────────────────────────────────────────── */
    .btn-controls {
      width: 100%;
      max-width: 540px;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }
    .joint-control {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 0.75rem 1rem;
    }
    .joint-control h3 {
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--accent-lt);
      text-transform: uppercase;
      letter-spacing: .06em;
      margin-bottom: 0.5rem;
    }
    .joint-btns {
      display: flex;
      gap: 0.5rem;
    }
    .joint-btns button {
      flex: 1;
      padding: 0.4rem 0;
      background: rgba(124,106,247,.15);
      border: 1px solid rgba(124,106,247,.3);
      border-radius: 6px;
      color: var(--accent-lt);
      font-size: 0.85rem;
      font-weight: 700;
      cursor: pointer;
      transition: background var(--transition);
    }
    .joint-btns button:hover {
      background: rgba(124,106,247,.35);
    }

    /* ── Footer ────────────────────────────────────────────────────────────── */
    footer {
      text-align: center;
      padding: 1.5rem;
      color: var(--text-muted);
      font-size: 0.85rem;
      border-top: 1px solid var(--border);
    }

    @media (max-width: 480px) {
      .controls-grid { grid-template-columns: 1fr; }
      .btn-controls { grid-template-columns: 1fr 1fr; }
      .navbar { padding: 0.85rem 1.25rem; }
    }
  </style>
</head>
<body>

  <!-- Navigation -->
  <nav class="navbar">
    <span class="nav-logo">Berry Better Solutions</span>
    <a href="index.html" class="nav-back">← Back to Profile</a>
  </nav>

  <main>

    <div class="page-header">
      <h1>3D <span class="accent">Robot Arm</span></h1>
      <p>Interactive port of an OpenGL/C++ robot arm — built with Three.js</p>
    </div>

    <!-- Three.js canvas -->
    <div class="canvas-wrapper">
      <canvas id="arm-canvas" tabindex="0" aria-label="3D Robot Arm interactive demo"></canvas>
    </div>

    <!-- On-screen button controls -->
    <div class="btn-controls">
      <div class="joint-control">
        <h3>Shoulder</h3>
        <div class="joint-btns">
          <button data-joint="shoulder" data-dir="1">+ s</button>
          <button data-joint="shoulder" data-dir="-1">− S</button>
        </div>
      </div>
      <div class="joint-control">
        <h3>Elbow</h3>
        <div class="joint-btns">
          <button data-joint="elbow" data-dir="1">+ e</button>
          <button data-joint="elbow" data-dir="-1">− E</button>
        </div>
      </div>
      <div class="joint-control">
        <h3>Wrist</h3>
        <div class="joint-btns">
          <button data-joint="wrist" data-dir="1">+ w</button>
          <button data-joint="wrist" data-dir="-1">− W</button>
        </div>
      </div>
      <div class="joint-control">
        <h3>Hand</h3>
        <div class="joint-btns">
          <button data-joint="grab" data-dir="1">Close g</button>
          <button data-joint="grab" data-dir="-1">Open G</button>
        </div>
      </div>
    </div>

    <!-- Keyboard reference -->
    <div class="controls-panel">
      <h2>Keyboard Controls</h2>
      <div class="controls-grid">
        <div class="control-row">
          <span class="control-label">Shoulder</span>
          <span class="keys"><kbd>s</kbd><kbd>S</kbd></span>
        </div>
        <div class="control-row">
          <span class="control-label">Elbow</span>
          <span class="keys"><kbd>e</kbd><kbd>E</kbd></span>
        </div>
        <div class="control-row">
          <span class="control-label">Wrist roll</span>
          <span class="keys"><kbd>w</kbd><kbd>W</kbd></span>
        </div>
        <div class="control-row">
          <span class="control-label">Hand (fingers)</span>
          <span class="keys"><kbd title="Close fingers">g</kbd><kbd title="Open fingers">G</kbd></span>
        </div>
        <div class="control-row hand-legend-detail" aria-hidden="true">
          <span class="hand-hint">
            <span class="hand-hint-item"><kbd>g</kbd> close</span>
            <span class="hand-hint-item"><kbd>G</kbd> open</span>
          </span>
        </div>
      </div>
    </div>

  </main>

  <footer>
    <p>&copy; <span id="year"></span> dcbgi. Ported from
      <a href="https://github.com/dcbgi/arm" target="_blank" rel="noopener noreferrer">dcbgi/arm</a>.</p>
  </footer>

  <!-- Three.js r160 (bundled locally, no known vulnerabilities) -->
  <script src="three.min.js"></script>

  <script>
  // ─── Footer year ─────────────────────────────────────────────────────────────
  (function () {
    const el = document.getElementById("year");
    if (el) el.textContent = new Date().getFullYear();
  }());

  // ─── 3D Robot Arm ────────────────────────────────────────────────────────────
  // Ported from: https://github.com/dcbgi/arm (Geometry 3D Robot.cpp)
  //
  // Original C++ structure preserved: shoulder → elbow → wrist → fingers (×4)
  // each with a proximal and a grab-controlled distal segment.
  // Controls: s/S shoulder, e/E elbow, w/W wrist, g/G grab
  (function () {
    const canvas = document.getElementById("arm-canvas");

    // ── Renderer ──────────────────────────────────────────────────────────────
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

    // ── Scene ─────────────────────────────────────────────────────────────────
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0f1117);

    // ── Camera ────────────────────────────────────────────────────────────────
    // Mirrors: gluPerspective(65, 1, 1, 20) + glTranslatef(0, 0, -5)
    const camera = new THREE.PerspectiveCamera(65, 1, 1, 20);
    camera.position.set(1.75, 0, 5);

    // ── Wire-cube helper ──────────────────────────────────────────────────────
    // Mirrors: glutWireCube(1) with a prior glScalef(w, h, d)
    const wireMat = new THREE.LineBasicMaterial({ color: 0xffffff });
    function wireBox(w, h, d) {
      return new THREE.LineSegments(
        new THREE.EdgesGeometry(new THREE.BoxGeometry(w, h, d)),
        wireMat
      );
    }

    // ── init() — arm hierarchy ────────────────────────────────────────────────
    // Shoulder pivot: glTranslatef(-1,0,0) + glRotatef(shoulder,Z) + glTranslatef(1,0,0)
    const shoulderGroup = new THREE.Group();
    shoulderGroup.position.x = -1;
    scene.add(shoulderGroup);

    const upperArm = wireBox(2, 0.4, 1);   // glScalef(2, 0.4, 1) + glutWireCube(1)
    upperArm.position.x = 1;
    shoulderGroup.add(upperArm);

    // Elbow pivot: glTranslatef(1,0,0) + glRotatef(elbow,Z) + glTranslatef(1,0,0)
    //   placed at x=+2 from shoulder group origin (right edge of upper arm)
    const elbowGroup = new THREE.Group();
    elbowGroup.position.x = 2;
    shoulderGroup.add(elbowGroup);

    const foreArm = wireBox(2, 0.4, 1);    // glScalef(2, 0.4, 1) + glutWireCube(1)
    foreArm.position.x = 1;
    elbowGroup.add(foreArm);

    // Wrist pivot: glTranslatef(.3,0,0) + glRotatef(wrist,X) + glTranslatef(.3,0,0)
    //   placed at x=+2 from elbow group origin (right edge of forearm)
    const wristGroup = new THREE.Group();
    wristGroup.position.x = 2;
    elbowGroup.add(wristGroup);

    const wristSeg = wireBox(0.2, 1, 1);   // glScalef(.2, 1, 1) + glutWireCube(1)
    wristSeg.position.x = 0.1;
    wristGroup.add(wristSeg);

    // ── Fingers (×4) ─────────────────────────────────────────────────────────
    // Original: 4 fingers each with 2 segments.
    // Finger 1 (top):    y=+0.4, grab rotates around -Z
    // Finger 2 (bottom): y=-0.4, grab rotates around +Z
    // Finger 3 (front):  z=+0.4, grab rotates around +Y
    // Finger 4 (back):   z=-0.4, grab rotates around -Y
    const fingerDefs = [
      { offset: [0,  0.4, 0],  grabAxis: new THREE.Vector3(0, 0, -1) },
      { offset: [0, -0.4, 0],  grabAxis: new THREE.Vector3(0, 0,  1) },
      { offset: [0, 0,  0.4],  grabAxis: new THREE.Vector3(0,  1, 0) },
      { offset: [0, 0, -0.4],  grabAxis: new THREE.Vector3(0, -1, 0) },
    ];

    const fingerTipGroups = [];

    fingerDefs.forEach(function (def) {
      var ox = def.offset[0], oy = def.offset[1], oz = def.offset[2];

      // Proximal phalanx (glScalef(3,1,1) + glutWireCube(.2) → 0.6×0.2×0.2)
      var proximal = wireBox(0.6, 0.2, 0.2);
      proximal.position.set(0.55 + ox, oy, oz);
      wristGroup.add(proximal);

      // Distal pivot (grab rotation)
      var tipGroup = new THREE.Group();
      tipGroup.position.set(0.9 + ox, oy, oz);
      wristGroup.add(tipGroup);

      // Distal phalanx (glScalef(3,1,1) + glutWireCube(.2) → 0.6×0.2×0.2)
      var distal = wireBox(0.6, 0.2, 0.2);
      distal.position.x = 0.3;
      tipGroup.add(distal);

      fingerTipGroups.push({ group: tipGroup, axis: def.grabAxis });
    });

    // ── Joint state ───────────────────────────────────────────────────────────
    var shoulder = 0, elbow = 0, wrist = 0, grab = 0;
    var DEG = Math.PI / 180;

    // ── display() equivalent — apply joint angles ─────────────────────────────
    function applyAngles() {
      shoulderGroup.rotation.z = shoulder * DEG;
      elbowGroup.rotation.z    = elbow    * DEG;
      wristGroup.rotation.x    = wrist    * DEG;
      fingerTipGroups.forEach(function (f) {
        f.group.setRotationFromAxisAngle(f.axis, grab * DEG);
      });
    }

    // ── keyboard() equivalent ─────────────────────────────────────────────────
    function handleKey(key) {
      switch (key) {
        case "s": shoulder = (shoulder + 5) % 360; break;
        case "S": shoulder = (shoulder - 5 + 360) % 360; break;
        case "e": elbow    = (elbow    + 5) % 360; break;
        case "E": elbow    = (elbow    - 5 + 360) % 360; break;
        case "w": wrist    = (wrist    + 5) % 360; break;
        case "W": wrist    = (wrist    - 5 + 360) % 360; break;
        case "g": grab     = (grab     + 5) % 360; break;
        case "G": grab     = (grab     - 5 + 360) % 360; break;
        default: return;
      }
      applyAngles();
    }

    document.addEventListener("keydown", function (e) {
      handleKey(e.key);
    });

    // ── On-screen buttons ─────────────────────────────────────────────────────
    document.querySelectorAll("[data-joint]").forEach(function (btn) {
      btn.addEventListener("click", function () {
        var joint = btn.getAttribute("data-joint");
        var dir   = parseInt(btn.getAttribute("data-dir"), 10);
        var key   = { shoulder: "s", elbow: "e", wrist: "w", grab: "g" }[joint];
        handleKey(dir > 0 ? key : key.toUpperCase());
      });
    });

    // ── reshape() equivalent — handle canvas resize ───────────────────────────
    function onResize() {
      var wrapper = canvas.parentElement;
      var size = Math.min(wrapper.clientWidth - 32, 500);
      renderer.setSize(size, size);
    }
    window.addEventListener("resize", onResize);
    onResize();

    // ── Render loop ───────────────────────────────────────────────────────────
    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }
    animate();
  }());
  </script>

</body>
</html>
